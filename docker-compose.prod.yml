version: '3.8'

name: hello-dalle-discordbot

services:
  hello-dalle-discordbot:
    build:
      context: .
      dockerfile: Dockerfile
      target: production
    image: heavygee/hello-dalle-discordbot:latest
    container_name: hello-dalle-discordbot
    env_file:
      - .env
    environment:
      # Environment variables loaded from .env file
      - DISCORD_BOT_TOKEN=${DISCORD_BOT_TOKEN}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - BOTSPAM_CHANNEL_ID=${BOTSPAM_CHANNEL_ID}
      - PROFILE_CHANNEL_ID=${PROFILE_CHANNEL_ID}
      - WELCOME_CHANNEL_ID=${WELCOME_CHANNEL_ID}
      - BOT_USER_ROLE=${BOT_USER_ROLE}
      - WELCOME_PROMPT=${WELCOME_PROMPT}
      - GENDER_SENSITIVITY=${GENDER_SENSITIVITY:-false}
      - STEALTH_WELCOME=${STEALTH_WELCOME:-false}
      - WILDCARD=${WILDCARD:-0}
      - DEBUG=${DEBUG:-false}
      # Production-specific overrides
      - NODE_ENV=production
    volumes:
      # Mount data directory for persistent storage
      - ./data:/usr/src/app/data
      # Mount logs directory if needed
      - ./logs:/usr/src/app/logs
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "node", "-e", "process.exit(0)"]  # Simple health check
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s 