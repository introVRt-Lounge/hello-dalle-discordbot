---
description: AI rules derived by SpecStory from the project AI interaction history
globs: *
---

## <headers/>

## PROJECT RULES

### GENERAL
- Project-specific rules are defined in this file and should always be obeyed.
- If there is a conflict between a general coding principle and a project-specific rule, the project-specific rule takes precedence.

### VERSIONING
- Follow Semantic Versioning (SemVer) for all releases.
- Use clear and descriptive commit messages.

## TECH STACK

### LANGUAGES
- Typescript

### FRAMEWORKS & LIBRARIES
- Discord.js:  (version 14 or higher) for interacting with the Discord API.
- OpenAI API: For generating images using DALL-E.
- Jest:  For unit and integration testing.
- Dotenv: For managing environment variables.
- Axios: For making HTTP requests.
- Mermaid: For generating diagrams.

### CODING TOOLS
- ES Lint
- Prettier

## CODING STANDARDS

### TYPESCRIPT
- Use Typescript strict mode.
- All code must be properly typed.
- Use interfaces and classes where appropriate to ensure code is modular and reusable.
- Adhere to consistent naming conventions.

### ASYNCHRONOUS CODE
- Use async/await for handling asynchronous operations.
- Implement proper error handling for all asynchronous functions.

### DISCORD.JS
- Use Discord.js v14 or higher.
- Properly handle Discord API rate limits.
- Implement gateway intents to optimize bot performance and comply with Discord's requirements.

### COMMENTS & DOCUMENTATION
- Document all functions and classes using JSDoc syntax.
- Explain the purpose, parameters, and return values.
- Add comments to complex or non-obvious code sections.

## BRANCHING & MERGING

### BRANCHING
- Create feature branches for all new development.
- Name branches descriptively (e.g., feature/add-gemini-support).
- Avoid long-lived feature branches; keep them as short as possible.

### MERGING
- Use pull requests for all merges.
- Squash feature branches before merging to keep the commit history clean.
- Ensure PR titles and descriptions are clear and descriptive.

## COMMIT MESSAGES

### FORMAT
- Use clear and descriptive commit messages, following the Conventional Commits specification (https://www.conventionalcommits.org/en/v1.0.0/).
- Keep commit messages concise and to the point.

### EXAMPLES
- "feat: Add user authentication"
- "fix: Resolve issue with rate limiting"
- "docs: Update README with deployment instructions"
- "refactor: Improve code structure for better readability"

## PROJECT DOCUMENTATION & CONTEXT SYSTEM

### README.MD
- Provide a high-level overview of the project.
- Include setup and deployment instructions.
- Document all environment variables and their purpose.
- Explain the project's architecture and key components.

### IMAGE-GENERATION-FLOWS.MD
- (This File) Document all image generation flows, including:
  - Step-by-step processes with Mermaid diagrams.
  - API costs.
  - Code examples.
  - Known limitations.
  - Performance considerations.
  - When to choose each engine (DALL-E vs Gemini).
  - Include examples of generated content.
   - Present them using a comparison grid with the original input alongside the generated images.
   - Use the following columns: "Original Avatar", "DALL-E Result (Two-Step)", and "Gemini Result (Multimodal)".
      - Use the following naming convention: `welcome-USERNAME-THEME-dalle.png` / `welcome-USERNAME-THEME-gemini.png`
      - For PFP transformations, the type should be `pfp`
   - Use small font sizes and consistent formatting to present all the data clearly.
  - All prompts should use proper markdown formatting with small text and curly braces to indicate AI-generated prompt components. 
   - Example: `"Transform this profile picture described as: **{AI description text}** according to: space explorer..."`

#### Engine Comparison Table

| Feature | DALL-E 3 | Gemini 2.5 Flash Image |
|---------|----------|----------------------|
| **Input Type** | Text prompts only | Text + Image (multimodal) |
| **Welcome Images** | Avatar analysis + text generation | Direct avatar image + enhanced prompt |
| **Profile Pictures** | Username-based or avatar-enhanced generation | Avatar-based transformation |
| **use-existing-pfp** | âŒ Not available | Direct image-to-image transformation |
| **Customization** | Text prompts with optional avatar enhancement | Text prompts + direct image manipulation |
| **Quality** | High consistency, creative freedom | Superior subject preservation & accuracy |
| **Cost** | $0.04/image (1 API call) | ~$0.08/image (2 API calls) |
| **Speed** | Fast (~10-20s) | Slower (~15-30s) |

> **â„¹ï¸ Note on &#96;use-existing-pfp&#96;**: This option provides true avatar transformation and is only available with Gemini engine. DALL-E cannot perform image-to-image transformations but automatically includes avatar analysis in welcome images for enhanced personalization.

## ğŸ¯ **When to Choose Each Engine**

### Choose DALL-E When:
- **You want the cheapest option** - Single API call, lowest cost per image
- You want maximum creative freedom
- You prefer faster generation
- You're creating something completely new from scratch

### Choose Gemini When:
- **You want the most accurate images truly based on users' profile pictures**
- You need the highest subject consistency and personalization
- You're willing to pay more for better avatar transformations
- Quality and precision matter more than cost

---

**Ready to try it?** Set your default engine with `/engine` and experiment with `/pfp` and `/welcome` commands!

## ğŸ”— **Quick Links**
- [â† Back to README.md](../README.md) - Main documentation
- [ğŸ³ Docker Deployment](../README.md#deployment) - How to run the bot
- [âš™ï¸ Environment Setup](../README.md#environment-variables) - Configuration guide

---

*This documentation shows the actual differences between engines through examples and flowcharts, helping users understand which engine best fits their needs.*