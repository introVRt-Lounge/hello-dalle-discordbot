---
description: AI rules derived by SpecStory from the project AI interaction history
globs: *
---

## <headers/>

## PROJECT RULES

### GENERAL
- Project-specific rules are defined in this file and should always be obeyed.
- If there is a conflict between a general coding principle and a project-specific rule, the project-specific rule takes precedence.

### VERSIONING
- Follow Semantic Versioning (SemVer) for all releases.
- Use clear and descriptive commit messages.

## TECH STACK

### LANGUAGES
- Typescript

### FRAMEWORKS & LIBRARIES
- Discord.js:  (version 14 or higher) for interacting with the Discord API.
- OpenAI API: For generating images using DALL-E.
- Jest:  For unit and integration testing.
- Dotenv: For managing environment variables.
- Axios: For making HTTP requests.
- Mermaid: For generating diagrams.

### CODING TOOLS
- ES Lint
- Prettier

## CODING STANDARDS

### TYPESCRIPT
- Use Typescript strict mode.
- All code must be properly typed.
- Use interfaces and classes where appropriate to ensure code is modular and reusable.
- Adhere to consistent naming conventions.

### ASYNCHRONOUS CODE
- Use async/await for handling asynchronous operations.
- Implement proper error handling for all asynchronous functions.

### DISCORD.JS
- Use Discord.js v14 or higher.
- Properly handle Discord API rate limits.
- Implement gateway intents to optimize bot performance and comply with Discord's requirements.

### COMMENTS & DOCUMENTATION
- Document all functions and classes using JSDoc syntax.
- Explain the purpose, parameters, and return values.
- Add comments to complex or non-obvious code sections.

## BRANCHING & MERGING

### BRANCHING
- Create feature branches for all new development.
- Name branches descriptively (e.g., feature/add-gemini-support).
- Avoid long-lived feature branches; keep them as short as possible.

### MERGING
- Use pull requests for all merges.
- Squash feature branches before merging to keep the commit history clean.
- Ensure PR titles and descriptions are clear and descriptive.

## COMMIT MESSAGES

### FORMAT
- Use clear and descriptive commit messages, following the Conventional Commits specification (https://www.conventionalcommits.org/en/v1.0.0/).
- Keep commit messages concise and to the point.

### EXAMPLES
- "feat: Add user authentication"
- "fix: Resolve issue with rate limiting"
- "docs: Update README with deployment instructions"
- "refactor: Improve code structure for better readability"

## PROJECT DOCUMENTATION & CONTEXT SYSTEM

### README.MD
- Provide a high-level overview of the project.
- Include setup and deployment instructions.
- Document all environment variables and their purpose.
- Explain the project's architecture and key components.

### IMAGE-GENERATION-FLOWS.MD
- (This File) Document all image generation flows, including:
  - Step-by-step processes with Mermaid diagrams.
  - API costs.
  - Code examples.
  - Known limitations.
  - Performance considerations.
  - When to choose each engine (DALL-E vs Gemini).
  - Include examples of generated content.
   - Present them using a comparison grid with the original input alongside the generated images.
   - Use the following columns: "Original Avatar", "DALL-E Result (Two-Step)", and "Gemini Result (Multimodal)".
      - Use the following naming convention: `welcome-USERNAME-THEME-dalle.png` / `welcome-USERNAME-THEME-gemini.png`
      - For PFP transformations, the type should be `pfp`
   - Use small font sizes and consistent formatting to present all the data clearly.
  - All prompts should use proper markdown formatting with small text and curly braces to indicate AI-generated prompt components. 
   - Example: `"Transform this profile picture described as: **{AI description text}** according to: space explorer..."`

#### Overview Table

| Feature | DALL-E 3 | Gemini 2.5 Flash Image |
|---------|----------|----------------------|
| **Input Type** | Text prompts only | Text + Image (multimodal) |
| **Welcome Images** | Avatar analysis + text generation | Direct avatar image + enhanced prompt |
| **Profile Pictures** | Username-based or avatar-enhanced generation | Avatar-based transformation |
| **use-existing-pfp** | âŒ Not available | Direct image-to-image transformation |
| **Customization** | Text prompts with optional avatar enhancement | Text prompts + direct image manipulation |
| **Quality** | High consistency, creative freedom | Superior subject preservation & accuracy |
| **Cost** | $0.04/image (1 API call) | ~$0.08/image (2 API calls) |
| **Speed** | Fast (~10-20s) | Slower (~15-30s) |

> **â„¹ï¸ Note on &#96;use-existing-pfp&#96;**: This option provides true avatar transformation and is only available with Gemini engine. DALL-E cannot perform image-to-image transformations but automatically includes avatar analysis in welcome images for enhanced personalization.

## ðŸŽ¯ **When to Choose Each Engine**

### Choose DALL-E When:
- **You want the cheapest option** - Single API call, lowest cost per image
- You want maximum creative freedom
- You prefer faster generation
- You're creating something completely new from scratch

### Choose Gemini When:
- **You want the most accurate images truly based on users' profile pictures**
- You need the highest subject consistency and personalization
- You're willing to pay more for better avatar transformations
- Quality and precision matter more than cost

---

## ðŸŽ¨ **Real Examples: Engine Differences in Action**

> **The proof is in the generated images.** Below are actual test results showing how the same input produces dramatically different results with each engine. These examples were generated using profile pictures from the &#96;helpers/&#96; folder and demonstrate the qualitative differences between text-only generation (DALL-E) and multimodal analysis + generation (Gemini).

### 1. Ariabel - Default Welcome Image

**Scenario**: Default welcome image generation. Same avatar, different processing approaches.

| Original Avatar | DALL-E Result (Two-Step) | Gemini Result (Multimodal) |
|-----------------|-------------------------|---------------------------|
| <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/pfp1.png" width="200" height="200" alt="Ariabel's Avatar"> | <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/welcome-ariabel-default-dalle.png" width="300" height="300" alt="Ariabel DALL-E"> | <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/welcome-ariabel-default-gemini.png" width="300" height="300" alt="Ariabel Gemini"> |
| | <small>"Create a welcome image for Ariabel proclaimed upon and incorporated into a cyberpunk billboard in a mixture of synthwave and cyberpunk styles. Incorporate visual elements from this avatar description: **{Multicolored iridescent butterfly wings and intricate black fantasy outfit.}**"</small><br><small>_(Curly braces indicate AI-generated description)_</small> | <small>"Using the input image as reference: **{Illustration of a fantastical character with black and shimmering blue butterfly wings, pointed ears, and holding a glowing sword.}** Create a welcome image for Ariabel proclaimed upon and incorporated into a cyberpunk billboard in a mixture of synthwave and cyberpunk styles."</small><br><small>_(Curly braces indicate AI-generated description)_</small> |

### 2. heavygee - PFP Transformation (Space Explorer)

**Scenario**: Transform existing PFP into "space explorer" theme.

| Original Avatar | DALL-E Result (Vision Analysis) | Gemini Result (Direct Transform) |
|-----------------|-------------------------------|-----------------------------|
| <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/pfp6.png" width="200" height="200" alt="heavygee's Avatar"> | <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/pfp-heavygee-space-explorer-dalle.png" width="300" height="300" alt="heavygee DALL-E"> | <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/pfp-heavygee-space-explorer-gemini.png" width="300" height="300" alt="heavygee Gemini"> |
| | <small>"Transform this profile picture described as: **{An image blending a real person's eyes and mouth with a classical sculpture's face and curly beard, featuring a monochrome blue tint.}** according to: space explorer. Create a new artistic version while maintaining the key visual characteristics. Image only, no text. Circular to ease cropping."</small><br><small>_(Curly braces indicate AI-generated description)_</small> | <small>"Using the input image as reference: **{An image blending a real person's eyes and mouth with a classical sculpture's face and curly beard, featuring a monochrome blue tint.}** Maintain the subject's pose and appearance while transforming them into a space explorer in a highly detailed artistic style. Circular to ease cropping."</small><br><small>_(Curly braces indicate AI-generated description)_</small> |

### 3. radgey - PFP Transformation (Medieval Knight)

**Scenario**: Transform existing PFP into "medieval knight" theme.

| Original Avatar | DALL-E Result (Vision Analysis) | Gemini Result (Direct Transform) |
|-----------------|-------------------------------|-----------------------------|
| <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/pfp5.png" width="200" height="200" alt="radgey's Avatar"> | <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/pfp-radgey-medieval-knight-dalle.png" width="300" height="300" alt="radgey DALL-E"> | <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/pfp-radgey-medieval-knight-gemini.png" width="300" height="300" alt="radgey Gemini"> |
| | <small>"Transform this profile picture described as: **{man with a surprised expression and raised eyebrows}** according to: medieval knight. Create a new artistic version while maintaining the key visual characteristics. Image only, no text. Circular to ease cropping."</small><br><small>_(AI-generated description in **bold**)_</small> | <small>"Using the input image as reference: **{man with a surprised expression and raised eyebrows}**. Maintain the subject's pose and appearance while transforming them into a medieval knight in a highly detailed artistic style. Circular to ease cropping."</small><br><small>_(AI-generated description in **bold**)_</small> |

### 4. tokentrevor - Welcome Image (Steampunk City)

**Scenario**: Welcome image with custom "steampunk city" theme. Shows how different settings affect personalization.

| Original Avatar | DALL-E Result (Two-Step) | Gemini Result (Multimodal) |
|-----------------|-------------------------|---------------------------|
| <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/pfp3.png" width="200" height="200" alt="tokentrevor's Avatar"> | <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/welcome-tokentrevor-steampunk-dalle.png" width="300" height="300" alt="tokentrevor DALL-E"> | <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/welcome-tokentrevor-steampunk-gemini.png" width="300" height="300" alt="tokentrevor Gemini"> |
| | <small>"Create a welcome image for tokentrevor proclaimed upon and incorporated into a steampunk city billboard in Victorian-era mechanical styles. Incorporate visual elements from this avatar description: **{broad smiling face with green eyes.}**"</small><br><small>_(Curly braces indicate AI-generated description)_</small> | <small>"Using the input image as reference: **{broad grin with an open mouth and visible teeth.}** Create a welcome image for tokentrevor proclaimed upon and incorporated into a steampunk city billboard in Victorian-era mechanical styles."</small><br><small>_(Curly braces indicate AI-generated description)_</small> |

### 5. wallac3 - PFP Transformation (Superhero)

**Scenario**: Transform existing PFP into "superhero" theme.

| Original Avatar | DALL-E Result (Vision Analysis) | Gemini Result (Direct Transform) |
|-----------------|-------------------------------|-----------------------------|
| <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/pfp4.png" width="200" height="200" alt="wallac3's Avatar"> | <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/pfp-wallac3-superhero-dalle.png" width="300" height="300" alt="wallac3 DALL-E"> | <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/pfp-wallac3-superhero-gemini.png" width="300" height="300" alt="wallac3 Gemini"> |
| | <small>"Transform this profile picture described as: **{A 3D cartoon character with oversized hands, a wide smile, wearing a white cap and a green textured sweater against a sparkling multicolored background.}** according to: superhero. Create a new artistic version while maintaining the key visual characteristics. Image only, no text. Circular to ease cropping."</small><br><small>_(AI-generated description in **bold**)_</small> | <small>"Using the input image as reference: **{A 3D cartoon character with oversized hands, a wide smile, wearing a white cap and a green textured sweater against a sparkling multicolored background.}** Maintain the subject's pose and appearance while transforming them into a superhero in a highly detailed artistic style. Circular to ease cropping."</small><br><small>_(AI-generated description in **bold**)_</small> |

### 6. pecachu - Default Welcome Image

**Scenario**: Default welcome image (same as #1, for comparison). Shows Pikachu-style avatar processing.

| Original Avatar | DALL-E Result (Two-Step) | Gemini Result (Multimodal) |
|-----------------|-------------------------|---------------------------|
| <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/pfp2.png" width="200" height="200" alt="pecachu's Avatar"> | <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/welcome-pecachu-default-dalle.png" width="300" height="300" alt="pecachu DALL-E"> | <img src="https://raw.githubusercontent.com/introVRt-Lounge/hello-dalle-discordbot/feature/gemini/docs/assets/welcome-pecachu-default-gemini.png" width="300" height="300" alt="pecachu Gemini"> |
| | <small>"Create a welcome image for pecachu proclaimed upon and incorporated into a cyberpunk billboard in a mixture of synthwave and cyberpunk styles. Incorporate visual elements from this avatar description: **{Yellow and pink cartoon-style character with heart and star shapes, labeled 'PECACHU'.}**"</small><br><small>_(AI-generated description in **bold**)_</small> | <small>"Using the input image as reference: **{'A yellow and pink stylized pin design of Pikachu with muscular arms, featuring stars and hearts.'}** Create a welcome image for pecachu proclaimed upon and incorporated into a cyberpunk billboard in a mixture of synthwave and cyberpunk styles."</small><br><small>_(AI-generated description in **bold**)_</small> |

---

*This documentation shows the actual differences between engines through examples and flowcharts, helping users understand which engine best fits their needs.*

## ðŸŽ¯ Production Behavior by Default Engine